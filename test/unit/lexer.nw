
@
this is the part that will test the lexer file

<<test code>>=
var expect = require('chai').expect;
console.log("this is from the test file");


describe("testing the adjustString", function(){
  it("giving it no input", function(done){
    var input = {text:"1234567890", column:0}
    adjustString(input, 0);
    expect(input).to.have.property("text", "1234567890")
    expect(input).to.have.property("column", 0)
    done();
  })
});


describe("testing text", function(){
  it("going to test normal text with bar", function(done){
    var result = lexer("|  this is some text");
    /* console.log("result: " + JSON.stringify(result, null, 2)); */
    expect(result).to.be.an("array").with.length(1);

    /* var barToken = result[0]; */
    /* expect(barToken).to.have.property("type","vertical bar"); */


    var rawTextToken = result[0];
    expect(rawTextToken).to.have.property("type", "rawText");
    expect(rawTextToken).to.have.property("value", " this is some text");
    done();
  })
});

describe("testing the if statement", function(){
  it("going to test a basic if statement", function(done){
    var result = lexer("if 1 == 0");
    /* console.log("result: " + JSON.stringify(result)); */
    expect(result).to.be.an("array").with.length(1);
    expect(result[0]).to.have.property("type","if");
    expect(result[0]).to.have.property("condition","1 == 0");
    done();
  });
});

describe("going to test directives", function(){
  it("basic simple p directive", function(done){
    var resultArr = lexer("p");
    /* console.log("result: " + JSON.stringify(resultArr, null, 2)); */

    expect(resultArr).to.be.a("array")
    .to.have.length(1);

    var result = resultArr[0];
    expect(result).to.be.a("object");
    expect(result).to.have.property("type", "directive");
    expect(result).to.have.property("name", "p");

    done();
  })

  it("bar text + if statement", function(done){
    var resultArr = lexer("if 1 == 2\n  | this is also some text");
    console.log("result: " + JSON.stringify(resultArr, null, 2));

    expect(resultArr).to.be.a("array")
    .to.have.length(3);

    var ifToken = resultArr[0];
    expect(ifToken).to.be.a("object");
    expect(ifToken).to.have.property("type", "if");
    expect(ifToken).to.have.property("condition", "1 == 2");

    var indent = resultArr[1];
    expect(indent).to.be.an("object");
    expect(indent).to.have.property("type", "indent");
    expect(indent).to.have.property("level", 2);
    expect(indent).to.have.property("indents", 1);

    var rawText = resultArr[2];
    expect(rawText).to.be.an("object");
    expect(rawText).to.have.property("type", "rawText");
    expect(rawText).to.have.property("value", "this is also some text");

    done();
  });
})

describe("testing the for loop", function(){
  it("testing basic for statement", function(done){
    // get the lexed object
    var resultArr = lexer("for (var i = 0; i < 100; i++)");

    // run the tests
    expect(resultArr)
    .to.be.a('array')
    .to.have.length(1);

    var result = resultArr[0];
    expect(result).to.have.property("type", "for");
    expect(result).to.have.property("declaration", "var i = 0");
    expect(result).to.have.property("condition", "i < 100");
    expect(result).to.have.property("iteration", "i++");
    done();
  });


    it("testing basic for statement", function(done){
        // get the lexed object
        var resultArr = lexer("for (var i = 0; i < 100; i++)");

        // run the tests
        expect(resultArr)
        .to.be.a('array')
        .to.have.length(1);

        var result = resultArr[0];
        expect(result).to.have.property("type", "for");
        expect(result).to.have.property("declaration", "var i = 0");
        expect(result).to.have.property("condition", "i < 100");
        expect(result).to.have.property("iteration", "i++");
        done();
        });


    it("testing basic for statement without brackets", function(done){
        // get the lexed object
        var resultArr = lexer("for var i = 0; i < 100; i++");

        // run the tests
        expect(resultArr)
        .to.be.a('array')
        .to.have.length(1);

        var result = resultArr[0];
        expect(result).to.have.property("type", "for");
        expect(result).to.have.property("declaration", "var i = 0");
        expect(result).to.have.property("condition", "i < 100");
        expect(result).to.have.property("iteration", "i++");
        done();
        });


    it("for statement - brackets, +indents", function(done){
        // get the lexed object
        var resultArr = lexer("    for var i = 0; i < 100; i++");
        /* console.log("result: " + JSON.stringify(resultArr, null, 2)); */

        // run the tests
        expect(resultArr)
        .to.be.a('array')
        .to.have.length(2);

        var indentToken = resultArr[0];
        expect(indentToken).to.have.property("type", "indent");
        expect(indentToken).to.have.property("level", 4);
        expect(indentToken).to.have.property("indents", 1);


        var result = resultArr[1];
        expect(result).to.have.property("type", "for");
        expect(result).to.have.property("declaration", "var i = 0");
        expect(result).to.have.property("condition", "i < 100");
        expect(result).to.have.property("iteration", "i++");

        done();
    });
})

console.log("after the describe part");


/*

 */
function test(){
  var result = "";

  /* var source = {"text":"var numberOfApples = 10", "tokens":[], "level":0}; */
  /* result = nextToken(source); */
  /* if(result && result.type == "ident" && result.level == 0){ print("--broke 1---");  } */
  /* print("source: '" + source.text + "'"); */

  /* result = lexer("p. \n  asdasd asda \n  sdasdasd asdsa \n  dsa $zcxz adsad \n  asdad asda \nsdas d asd "); */
  /* print(" result: " + JSON.stringify(result)); */

  /* result = lexer("var apples = 10"); */
  /* expectedTypeOrder(result, ["var", "ident", "=", "number"]) */

  /* result = lexer("  var apples = 10"); */
  /* expectedTypeOrder(result, ["var", "ident", "=", "number"]) */

  /* result = lexer("div. \n  abc\n  | def"); */
  /* print("result: " + JSON.stringify(result)); */

  /* result = lexer("div. \n  abc asd sfsdf \ndiv  \n  | inside the second div"); */
  /* result = lexer("div \n  abc \ndiv  \n  | inside the second div"); */

  /*
     div 
     asd
     asdasd
     zcasd
     asdsad
   */
  /* result = lexer("div \n  asd\n    asdasd\n  zcasd\nasdsad"); */
  /* result = lexer("if true \n  var i = 10\nelse\n  var i = 20"); */

  /* result = lexer("div\n  if true \n    var i = 10\n  else\n    var i = 20"); */

  /* result = lexer("if 1 = 10\n  p\n    | this is in the true condition\nelse\n  p. \n    this is in the false condition"); */

  /* result = lexer("create block title\n  h1. \n  Welcome to our website"); */
  /* result = lexer("create block title\n  h1.  Welcome to our website"); */

  /* result = lexer("for(var i = 0; i < 10; i++)\n  p.\n    this is the $i div"); */


  /* result = lexer('div(num = 10)'); */
  /* print("result: " + JSON.stringify(result, null, 2)); */
}
function expectedTypeOrder(actual, expected){
  if(expected.length != actual.length)
    throw("the length is not the same expected: " + JSON.stringify(expected) +" actual: " + JSON.stringify(actual));
  for(var i = 0; i < actual.length; i++){
    /* console.log("i: " + i + " actual: " + actual[i]); */
    if(expected[i] !== actual[i].type)
      throw("i:  " + i + " expected type to be " + expected + " but got " + actual[i].type);
  }
}
test();




